{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport axios from 'axios';\nimport { history } from 'helpers';\nconst baseUrl = `${process.env.REACT_APP_API_URL}/accounts`;\nconst accountSubject = new BehaviorSubject(null);\nexport const accountService = {\n  login,\n  apiAuthenticate,\n  logout,\n  getAll,\n  getById,\n  update,\n  delete: _delete,\n  account: accountSubject.asObservable(),\n\n  get accountValue() {\n    return accountSubject.value;\n  }\n\n};\n\nasync function login() {\n  // login with facebook then authenticate with the API to get a JWT auth token\n  const {\n    authResponse\n  } = await new Promise(window.FB.login);\n  if (!authResponse) return;\n  await apiAuthenticate(authResponse.accessToken); // get return url from location state or default to home page\n\n  const {\n    from\n  } = history.location.state || {\n    from: {\n      pathname: \"/\"\n    }\n  };\n  history.push(from);\n}\n\nasync function apiAuthenticate(accessToken) {\n  // authenticate with the api using a facebook access token,\n  // on success the api returns an account object with a JWT auth token\n  const response = await axios.post(`${baseUrl}/authenticate`, {\n    accessToken\n  });\n  const account = response.data;\n  accountSubject.next(account);\n  startAuthenticateTimer();\n  return account;\n}\n\nfunction logout() {\n  // revoke app permissions to logout completely because FB.logout() doesn't remove FB cookie\n  window.FB.api('/me/permissions', 'delete', null, () => window.FB.logout());\n  stopAuthenticateTimer();\n  accountSubject.next(null);\n  history.push('/login');\n}\n\nfunction getAll() {\n  return axios.get(baseUrl).then(response => response.data);\n}\n\nfunction getById(id) {\n  return axios.get(`${baseUrl}/${id}`).then(response => response.data);\n}\n\nasync function update(id, params) {\n  var _accountSubject$value;\n\n  const response = await axios.put(`${baseUrl}/${id}`, params);\n  let account = response.data; // update the current account if it was updated\n\n  if (account.id === ((_accountSubject$value = accountSubject.value) === null || _accountSubject$value === void 0 ? void 0 : _accountSubject$value.id)) {\n    // publish updated account to subscribers\n    account = { ...accountSubject.value,\n      ...account\n    };\n    accountSubject.next(account);\n  }\n\n  return account;\n}\n\nasync function _delete(id) {\n  var _accountSubject$value2;\n\n  await axios.delete(`${baseUrl}/${id}`);\n\n  if (id === ((_accountSubject$value2 = accountSubject.value) === null || _accountSubject$value2 === void 0 ? void 0 : _accountSubject$value2.id)) {\n    // auto logout if the logged in account was deleted\n    logout();\n  }\n} // helper methods\n\n\nlet authenticateTimeout;\n\nfunction startAuthenticateTimer() {\n  // parse json object from base64 encoded jwt token\n  const jwtToken = JSON.parse(atob(accountSubject.value.token.split('.')[1])); // set a timeout to re-authenticate with the api one minute before the token expires\n\n  const expires = new Date(jwtToken.exp * 1000);\n  const timeout = expires.getTime() - Date.now() - 60 * 1000;\n  const {\n    accessToken\n  } = window.FB.getAuthResponse();\n  authenticateTimeout = setTimeout(() => apiAuthenticate(accessToken), timeout);\n}\n\nfunction stopAuthenticateTimer() {\n  // cancel timer for re-authenticating with the api\n  clearTimeout(authenticateTimeout);\n}","map":{"version":3,"names":["BehaviorSubject","axios","history","baseUrl","process","env","REACT_APP_API_URL","accountSubject","accountService","login","apiAuthenticate","logout","getAll","getById","update","delete","_delete","account","asObservable","accountValue","value","authResponse","Promise","window","FB","accessToken","from","location","state","pathname","push","response","post","data","next","startAuthenticateTimer","api","stopAuthenticateTimer","get","then","id","params","put","authenticateTimeout","jwtToken","JSON","parse","atob","token","split","expires","Date","exp","timeout","getTime","now","getAuthResponse","setTimeout","clearTimeout"],"sources":["C:/Users/davib/Desktop/FULL-MERN-STACK-CODEDAMN - Copy/client/src/services/account.service.js"],"sourcesContent":["import { BehaviorSubject } from 'rxjs';\r\nimport axios from 'axios';\r\n\r\nimport { history } from 'helpers';\r\n\r\nconst baseUrl = `${process.env.REACT_APP_API_URL}/accounts`;\r\nconst accountSubject = new BehaviorSubject(null);\r\n\r\nexport const accountService = {\r\n    login,\r\n    apiAuthenticate,\r\n    logout,\r\n    getAll,\r\n    getById,\r\n    update,\r\n    delete: _delete,\r\n    account: accountSubject.asObservable(),\r\n    get accountValue () { return accountSubject.value; }\r\n};\r\n\r\nasync function login() {\r\n    // login with facebook then authenticate with the API to get a JWT auth token\r\n    const { authResponse } = await new Promise(window.FB.login);\r\n    if (!authResponse) return;\r\n\r\n    await apiAuthenticate(authResponse.accessToken);\r\n\r\n    // get return url from location state or default to home page\r\n    const { from } = history.location.state || { from: { pathname: \"/\" } };\r\n    history.push(from);\r\n}\r\n\r\nasync function apiAuthenticate(accessToken) {\r\n    // authenticate with the api using a facebook access token,\r\n    // on success the api returns an account object with a JWT auth token\r\n    const response = await axios.post(`${baseUrl}/authenticate`, { accessToken });\r\n    const account = response.data;\r\n    accountSubject.next(account);\r\n    startAuthenticateTimer();\r\n    return account;\r\n}\r\n\r\nfunction logout() {\r\n    // revoke app permissions to logout completely because FB.logout() doesn't remove FB cookie\r\n    window.FB.api('/me/permissions', 'delete', null, () => window.FB.logout());\r\n    stopAuthenticateTimer();\r\n    accountSubject.next(null);\r\n    history.push('/login');\r\n}\r\n\r\nfunction getAll() {\r\n    return axios.get(baseUrl)\r\n        .then(response => response.data);\r\n}\r\n\r\nfunction getById(id) {\r\n    return axios.get(`${baseUrl}/${id}`)\r\n        .then(response => response.data);\r\n}\r\n\r\nasync function update(id, params) {\r\n    const response = await axios.put(`${baseUrl}/${id}`, params);\r\n    let account = response.data;\r\n    // update the current account if it was updated\r\n    if (account.id === accountSubject.value?.id) {\r\n        // publish updated account to subscribers\r\n        account = { ...accountSubject.value, ...account };\r\n        accountSubject.next(account);\r\n    }\r\n    return account;\r\n}\r\n\r\nasync function _delete(id) {\r\n    await axios.delete(`${baseUrl}/${id}`);\r\n    if (id === accountSubject.value?.id) {\r\n        // auto logout if the logged in account was deleted\r\n        logout();\r\n    }\r\n}\r\n\r\n// helper methods\r\n\r\nlet authenticateTimeout;\r\n\r\nfunction startAuthenticateTimer() {\r\n    // parse json object from base64 encoded jwt token\r\n    const jwtToken = JSON.parse(atob(accountSubject.value.token.split('.')[1]));\r\n\r\n    // set a timeout to re-authenticate with the api one minute before the token expires\r\n    const expires = new Date(jwtToken.exp * 1000);\r\n    const timeout = expires.getTime() - Date.now() - (60 * 1000);\r\n    const { accessToken } = window.FB.getAuthResponse();\r\n    authenticateTimeout = setTimeout(() => apiAuthenticate(accessToken), timeout);\r\n}\r\n\r\nfunction stopAuthenticateTimer() {\r\n    // cancel timer for re-authenticating with the api\r\n    clearTimeout(authenticateTimeout);\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}